<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>Derby</title>
        <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
        <script type="text/javascript" src="scripts/derby-simulator.js"></script>
        <script type="text/javascript" src="scripts/scene.js"></script>
        <script type="text/javascript" src="scripts/track.js"></script>
        <script type="text/javascript" src="scripts/team.js"></script>
        <script type="text/javascript" src="scripts/player.js"></script>
        <script type="text/javascript" src="scripts/bench.js"></script>
        <script type="text/javascript" src="scripts/penalty-box.js"></script>
        <script type="text/javascript" src="scripts/chair.js"></script>
        <script type="text/javascript" src="scripts/vector.js"></script>
        <script type="text/javascript" src="scripts/tools.js"></script>        
        <link rel="stylesheet" href="styles/track.css">
        <style>
            g.player {
                cursor:move;
            }
        </style>
        <script>
            var movingPlayer = null;
            
            $(document).ready(function(){
                myScene = new $derby.Scene({scale:0.3});
                $('body').get(0).appendChild(myScene.getElement());
                
                var allPlayers = $('g.player');
                allPlayers.each(function(index, element) {
                    $(element).mousedown(function(event) {
                        var id = $(element).attr('id')
                        movingPlayer = {
                            player: myScene.findObject(id),
                            clientX: event.clientX,
                            clientY: event.clientY
                        };
                    });
                });
                
                $(document).mousemove(function(event){
                    if(movingPlayer === null) return;
                    movingPlayer.player.setPosition(null, new $derby.Vector({
                        x:(event.clientX - movingPlayer.clientX) / myScene.opt.scale,
                        y:(event.clientY - movingPlayer.clientY) / myScene.opt.scale
                    }));
                    movingPlayer.clientX = event.clientX;
                    movingPlayer.clientY = event.clientY;

                });
                
                $(document).mouseup(function(){
                    movingPlayer = null;
                });
                
                
            });
            
            
        </script>
    </head>
    <body>
    </body>

</html>
